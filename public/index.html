<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Debate Argumentativo Libre</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: sans-serif; background: #f4f7fa; margin: 0; padding: 2rem; display: flex; justify-content: center; }
    .container { max-width: 800px; background: white; border-radius: 12px; box-shadow: 0 0 12px rgba(0,0,0,0.1); padding: 20px; width: 100%; }
    h1 { text-align: center; color: #2a4d7a; margin-bottom: 1rem; }
    .controls { display: flex; gap: 10px; margin-bottom: 1rem; }
    input, select { flex: 1; padding: 10px; font-size: 1rem; border-radius: 8px; border: 1px solid #ccc; }
    button { padding: 10px 16px; font-size: 1rem; border: none; border-radius: 8px; background: #2a4d7a; color: white; cursor: pointer; }
    button:hover { background: #1e3657; }
    .chat { border: 1px solid #ddd; border-radius: 8px; padding: 10px; height: 400px; overflow-y: auto; background: #fafafa; white-space: pre-wrap; }
    .row { margin-bottom: 1rem; }
    .alpha { color: #2a4d7a; font-weight: bold; }
    .beta { color: #22863a; font-weight: bold; }
    .typing { font-style: italic; color: #999; }
  </style>
</head>
<body>
<div class="container">
  <h1>Debate Argumentativo Libre</h1>
  <div class="controls">
    <input id="topic" placeholder="Tópico del debate" value="Mercados como unidad de análisis en el contexto histórico de Adam Smith y mercados actuales" />
    <select id="alphaStance">
      <option value="pro">Alpha a favor</option>
      <option value="contra">Alpha en contra</option>
    </select>
    <select id="betaStance">
      <option value="contra">Beta en contra</option>
      <option value="pro">Beta a favor</option>
    </select>
  </div>
  <div class="controls">
    <input id="turns" type="number" value="5" min="1" max="10" />
    <input id="delay" type="number" value="2500" min="100" step="100" />
    <button id="start">Iniciar</button>
    <button id="clear">Limpiar</button>
  </div>
  <div id="chat" class="chat"></div>
</div>

<script>
const chat = document.getElementById('chat');
const startBtn = document.getElementById('start');
const clearBtn = document.getElementById('clear');
let stop = false;

function appendMessage(speaker, message) {
  const div = document.createElement('div');
  div.className = 'row';
  div.innerHTML = `<span class="${speaker.toLowerCase()}">${speaker}:</span> ${message}`;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function delay(ms) { return new Promise(r => setTimeout(r, ms)); }

clearBtn.onclick = () => {
  chat.innerHTML = '';
  stop = true;
};

startBtn.onclick = async () => {
  chat.innerHTML = '';
  stop = false;
  const topic = document.getElementById('topic').value;
  const alphaStance = document.getElementById('alphaStance').value;
  const betaStance = document.getElementById('betaStance').value;
  const turns = parseInt(document.getElementById('turns').value, 10);
  const delayMs = parseInt(document.getElementById('delay').value, 10);

  let lastBeta = '';
  let alphaPrompt = `Sos AI Alpha. Defendé la postura ${alphaStance.toUpperCase()} sobre: ${topic}. Debatí con respeto y firmeza. Respondé con 1-2 oraciones. Terminá con una pregunta.`;
  let betaPrompt  = `Sos AI Beta. Defendé la postura ${betaStance.toUpperCase()} sobre: ${topic}. No repitas lo de Alpha. Contraargumentá con datos o ejemplos. Respondé con 1-2 oraciones y terminá con punto.`;

  let alphaMsg = "Comencemos el debate. ¿Por qué tu postura es la más convincente?";

  for (let i = 0; i < turns && !stop; i++) {
    appendMessage('Alpha', '...');
    const resAlpha = await fetch('/.netlify/functions/dialog-libre?' + new URLSearchParams({ role: 'Alpha', prompt: alphaMsg, topic, stance: alphaStance }));
    const dataAlpha = await resAlpha.json();
    chat.lastChild.remove();
    appendMessage('Alpha', dataAlpha.message);
    await delay(delayMs);

    if (stop) break;

    appendMessage('Beta', '...');
    const resBeta = await fetch('/.netlify/functions/dialog-libre?' + new URLSearchParams({ role: 'Beta', prompt: dataAlpha.message, topic, stance: betaStance }));
    const dataBeta = await resBeta.json();
    chat.lastChild.remove();
    appendMessage('Beta', dataBeta.message);
    alphaMsg = dataBeta.message;
    await delay(delayMs);
  }
};
</script>
</body>
</html>
