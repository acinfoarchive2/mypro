<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Diálogo / Debate entre IA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f4f7fa; --card: #fff; --primary: #2a4d7a; --primary-600: #1e3657;
      --border: #e0e6ed; --alpha: #2a4d7a; --beta: #22863a;
    }
    * { box-sizing: border-box; }
    body { font-family: system-ui, sans-serif; background: var(--bg); margin: 0; min-height: 100vh; display: flex; justify-content: center; align-items: flex-start; }
    .container { background: var(--card); margin: 32px 16px; padding: 20px; border-radius: 16px; box-shadow: 0 8px 24px rgba(0,0,0,0.08); width: 100%; max-width: 820px; }
    h1 { font-size: 1.5rem; margin: 0 0 12px; text-align: center; color: var(--primary); }
    p.sub { text-align: center; color: #5b6b7e; margin: 0 0 16px; font-size: 0.95rem; }
    .grid { display: grid; gap: 8px; margin-bottom: 12px; }
    .g2 { grid-template-columns: 1fr auto; }
    .g3 { grid-template-columns: repeat(3, 1fr); }
    .g4 { grid-template-columns: repeat(4, 1fr); }
    input, select { width: 100%; padding: 10px 12px; border: 1px solid #cfd7df; border-radius: 10px; font-size: 0.95rem; outline: none; }
    button { background: var(--primary); color: #fff; border: none; padding: 10px 16px; border-radius: 10px; cursor: pointer; font-size: 0.95rem; transition: background 0.15s ease; min-width: 120px; }
    button:hover { background: var(--primary-600); }
    .chat { background: #f9fbfd; border: 1px solid var(--border); border-radius: 12px; padding: 12px; height: 420px; overflow-y: auto; line-height: 1.5; }
    .row { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
    .badge { padding: 4px 8px; border-radius: 999px; font-size: 0.8rem; font-weight: 700; white-space: nowrap; }
    .alpha { color: var(--alpha); border: 1px solid var(--alpha); }
    .beta { color: var(--beta); border: 1px solid var(--beta); }
    .msg { background: #fff; border: 1px solid var(--border); padding: 10px 12px; border-radius: 10px; flex: 1; }
    .footer-note { color: #7a8aa0; font-size: 0.85rem; margin-top: 10px; text-align: center; }
    .pill { display:inline-block; padding:4px 8px; border-radius:999px; background:#eef4ff; color:#1e3657; font-size:.8rem; margin-bottom:8px;}
  </style>
</head>
<body>
  <div class="container">
    <h1>Diálogo / Debate entre dos IA</h1>
    <p class="sub">Elegí el modo. En debate, Alpha pregunta y defiende su postura; Beta responde y contra-argumenta.</p>

    <div class="grid g2">
      <input id="topic" placeholder="Tópico" value="Mercados como unidad de análisis en el contexto histórico de Adam Smith y mercados actuales" />
      <button id="run">Iniciar</button>
    </div>

    <div class="grid g4">
      <select id="mode">
        <option value="debate">Debate</option>
        <option value="dialog">Diálogo</option>
      </select>
      <select id="alpha_stance" title="Postura de Alpha">
        <option value="pro">Alpha: Pro</option>
        <option value="contra">Alpha: Contra</option>
      </select>
      <select id="beta_stance" title="Postura de Beta">
        <option value="contra">Beta: Contra</option>
        <option value="pro">Beta: Pro</option>
      </select>
      <input id="max_tokens" type="number" min="30" max="300" value="140" title="Máx. tokens por turno" />
    </div>

    <div class="grid g3">
      <input id="interactions" type="number" min="1" max="10" value="3" title="Interacciones" />
      <button id="clear">Limpiar</button>
      <span class="pill" id="badge"></span>
    </div>

    <div id="log" class="chat" aria-live="polite"></div>

    <div class="footer-note">
      Requiere <code>OPENAI_API_KEY</code> en Variables de entorno (Netlify → Site settings → Environment).
    </div>
  </div>

  <script>
    const logEl = document.getElementById('log');
    const runBtn = document.getElementById('run');
    const clearBtn = document.getElementById('clear');
    const badge = document.getElementById('badge');

    function appendLine(speaker, message) {
      const row = document.createElement('div');
      row.className = 'row';
      const badgeEl = document.createElement('span');
      badgeEl.className = 'badge ' + (speaker === 'Alpha' ? 'alpha' : 'beta');
      badgeEl.textContent = speaker;
      const msg = document.createElement('div');
      msg.className = 'msg';
      msg.textContent = message;
      row.appendChild(badgeEl);
      row.appendChild(msg);
      logEl.appendChild(row);
      logEl.scrollTop = logEl.scrollHeight;
    }

    clearBtn.onclick = () => { logEl.innerHTML = ''; };

    runBtn.onclick = async () => {
      logEl.innerHTML = '';
      runBtn.disabled = true; runBtn.textContent = 'Cargando…';

      const topic = document.getElementById('topic').value.trim();
      const interactions = Math.max(1, Math.min(10, parseInt(document.getElementById('interactions').value, 10) || 3));
      const max_tokens = Math.max(30, Math.min(300, parseInt(document.getElementById('max_tokens').value, 10) || 140));
      const mode = document.getElementById('mode').value;
      const alpha_stance = document.getElementById('alpha_stance').value;
      const beta_stance = document.getElementById('beta_stance').value;

      badge.textContent = mode === 'debate'
        ? `Modo: Debate · Alpha=${alpha_stance} · Beta=${beta_stance}`
        : `Modo: Diálogo`;

      const query = new URLSearchParams({
        interactions, max_tokens, mode, alpha_stance, beta_stance,
        ...(topic && { topic })
      });

      try {
        const res = await fetch('/.netlify/functions/dialog?' + query.toString());
        const data = await res.json();
        if (data.error) {
          appendLine('Error', data.error);
        } else {
          data.conversation.forEach(c => appendLine(c.speaker, c.message));
        }
      } catch (e) {
        appendLine('Error', e.message || 'Fallo desconocido');
      } finally {
        runBtn.disabled = false; runBtn.textContent = 'Iniciar';
      }
    };
  </script>
</body>
</html>
